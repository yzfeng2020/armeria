(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{"/94A":function(e){e.exports=JSON.parse('{"root":["index","setup"],"Useful links":{"Tutorials":"/tutorials","Community articles":"/community/articles","API documentation":"https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/index.html","Release notes":"/release-notes"},"Server":["server-basics","server-decorator","server-grpc","server-thrift","server-docservice","server-annotated-service","server-http-file","server-servlet","server-access-log","server-cors","server-sse","server-service-registration"],"Client":["client-http","client-thrift","client-grpc","client-factory","client-decorator","client-retrofit","client-custom-http-headers","client-timeouts","client-retry","client-circuit-breaker","client-service-discovery"],"Advanced":["advanced-logging","advanced-structured-logging","advanced-custom-attributes","advanced-streaming-backpressure","advanced-structured-logging-kafka","advanced-metrics","advanced-unit-testing","advanced-production-checklist","advanced-zipkin","advanced-saml","advanced-spring-webflux-integration","advanced-dropwizard-integration","advanced-scala","advanced-scalapb","advanced-client-interoperability"]}')},RVg9:function(e,a,t){"use strict";t.r(a),t.d(a,"pageTitle",(function(){return l})),t.d(a,"_frontmatter",(function(){return o})),t.d(a,"default",(function(){return b}));var i,r=t("zLVn"),n=(t("q1tI"),t("7ljp")),c=t("xCMr"),l="Serving static files",o={},p=(i="Tip",function(e){return console.warn("Component "+i+" was not imported, exported, or provided by MDXProvider as global scope"),Object(n.b)("div",e)}),s={pageTitle:l,_frontmatter:o},d=c.a;function b(e){var a=e.components,t=Object(r.a)(e,["components"]);return Object(n.b)(d,Object.assign({},s,t,{components:a,mdxType:"MDXLayout"}),Object(n.b)("h1",{id:"serving-static-files",style:{position:"relative"}},Object(n.b)("a",{parentName:"h1",href:"#serving-static-files","aria-label":"serving static files permalink",className:"anchor before"},Object(n.b)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},Object(n.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"Serving static files"),Object(n.b)("h6",{className:"inlinePageToc",role:"navigation"},"Table of contents"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",{parentName:"li",href:"#auto-generating-directory-listings"},"Auto-generating directory listings")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",{parentName:"li",href:"#specifying-additional-response-headers"},"Specifying additional response headers")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",{parentName:"li",href:"#adjusting-static-file-cache"},"Adjusting static file cache")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",{parentName:"li",href:"#serving-pre-compressed-files"},"Serving pre-compressed files")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",{parentName:"li",href:"#serving-an-individual-file"},"Serving an individual file")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",{parentName:"li",href:"#configuring-httpfile"},"Configuring HttpFile")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",{parentName:"li",href:"#caching-httpfile"},"Caching HttpFile")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",{parentName:"li",href:"#aggregating-httpfile"},"Aggregating HttpFile")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",{parentName:"li",href:"#building-aggregatedhttpfile-from-httpdata"},"Building AggregatedHttpFile from HttpData"))),Object(n.b)(p,{mdxType:"Tip"},Object(n.b)("p",null,"Visit ",Object(n.b)("a",{parentName:"p",href:"https://github.com/line/armeria-examples"},"armeria-examples")," to find a fully working example.")),Object(n.b)("p",null,"Use ",Object(n.b)("a",{parentName:"p",href:"type://FileService:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/FileService.html"},"type://FileService")," to serve static files under a certain directory. ",Object(n.b)("a",{parentName:"p",href:"type://FileService:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/FileService.html"},"type://FileService")," supports\n",Object(n.b)("inlineCode",{parentName:"p"},"GET")," and ",Object(n.b)("inlineCode",{parentName:"p"},"HEAD")," HTTP methods and will auto-fill ",Object(n.b)("inlineCode",{parentName:"p"},"Date"),", ",Object(n.b)("inlineCode",{parentName:"p"},"Last-Modified"),", ",Object(n.b)("inlineCode",{parentName:"p"},"ETag")," and auto-detected\n",Object(n.b)("inlineCode",{parentName:"p"},"Content-Type")," headers for you. It is also capable of sending a ",Object(n.b)("inlineCode",{parentName:"p"},"304 Not Modified")," response based on\n",Object(n.b)("inlineCode",{parentName:"p"},"If-None-Match")," and ",Object(n.b)("inlineCode",{parentName:"p"},"If-Modified-Since")," header values."),Object(n.b)("pre",null,Object(n.b)("code",{parentName:"pre",className:"language-java"},'import com.linecorp.armeria.server.ServerBuilder;\nimport com.linecorp.armeria.server.file.FileService;\n\nServerBuilder sb = Server.builder();\nsb.serviceUnder("/images/",\n                FileService.of(Paths.get("/var/lib/www/images"));\n\n// You can also serve the resources in the class path.\nsb.serviceUnder("/resources",\n                FileService.of(ClassLoader.getSystemClassLoader(),\n                               "/com/example/resources"));\n')),Object(n.b)("h2",{id:"auto-generating-directory-listings",style:{position:"relative"}},Object(n.b)("a",{parentName:"h2",href:"#auto-generating-directory-listings","aria-label":"auto generating directory listings permalink",className:"anchor before"},Object(n.b)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},Object(n.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"Auto-generating directory listings"),Object(n.b)("p",null,"You can configure ",Object(n.b)("a",{parentName:"p",href:"type://FileService:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/FileService.html"},"type://FileService")," to generate the directory listing of the directories without\nan ",Object(n.b)("inlineCode",{parentName:"p"},"index.html")," file using the ",Object(n.b)("inlineCode",{parentName:"p"},"autoIndex(boolean)")," method in ",Object(n.b)("a",{parentName:"p",href:"type://FileServiceBuilder:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/FileServiceBuilder.html"},"type://FileServiceBuilder"),"."),Object(n.b)("pre",null,Object(n.b)("code",{parentName:"pre",className:"language-java"},'import com.linecorp.armeria.server.file.FileServiceBuilder;\n\nFileServiceBuilder fsb =\n        FileService.builder(Paths.get("/var/lib/www/images"));\n\n// Enable auto-index.\nfsb.autoIndex(true);\nFileService fs = fsb.build();\n')),Object(n.b)(p,{mdxType:"Tip"},Object(n.b)("p",null,"Be careful when you enable this feature in production environment; consider its security implications.")),Object(n.b)("h2",{id:"specifying-additional-response-headers",style:{position:"relative"}},Object(n.b)("a",{parentName:"h2",href:"#specifying-additional-response-headers","aria-label":"specifying additional response headers permalink",className:"anchor before"},Object(n.b)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},Object(n.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"Specifying additional response headers"),Object(n.b)("p",null,"You can specify additional response headers such as ",Object(n.b)("inlineCode",{parentName:"p"},"cache-control")," and other custom headers."),Object(n.b)("pre",null,Object(n.b)("code",{parentName:"pre",className:"language-java"},'import com.linecorp.armeria.common.ServerCacheControl;\nimport com.linecorp.armeria.common.ServerCacheControlBuilder;\n\nFileServiceBuilder fsb =\n        FileService.builder(Paths.get("/var/lib/www/images"));\n\n// Specify cache control directives.\nServerCacheControl cc = ServerCacheControl.builder()\n                                          .maxAgeSeconds(86400)\n                                          .cachePublic()\n                                          .build();\nfsb.cacheControl(cc /* "max-age=86400, public" */);\n// Specify a custom header.\n\nfsb.setHeader("foo", "bar");\nFileService fs = fsb.build();\n')),Object(n.b)("h2",{id:"adjusting-static-file-cache",style:{position:"relative"}},Object(n.b)("a",{parentName:"h2",href:"#adjusting-static-file-cache","aria-label":"adjusting static file cache permalink",className:"anchor before"},Object(n.b)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},Object(n.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"Adjusting static file cache"),Object(n.b)("p",null,"By default, ",Object(n.b)("a",{parentName:"p",href:"type://FileService:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/FileService.html"},"type://FileService")," caches up to 1024 files whose length is less than or equal to\n65,536 bytes. You can customize this behavior using ",Object(n.b)("a",{parentName:"p",href:"type://FileServiceBuilder:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/FileServiceBuilder.html"},"type://FileServiceBuilder"),"."),Object(n.b)("pre",null,Object(n.b)("code",{parentName:"pre",className:"language-java"},'FileServiceBuilder fsb =\n        FileService.builder(Paths.get("/var/lib/www/images"));\n\n// Cache up to 4096 files.\nfsb.entryCacheSpec("maximumSize=4096");\n// Cache files whose length is less than or equal to 1 MiB.\nfsb.maxCacheEntrySizeBytes(1048576);\n\nFileService fs = fsb.build();\n')),Object(n.b)("p",null,"The cache can be disabled by specifying ",Object(n.b)("inlineCode",{parentName:"p"},"0")," for ",Object(n.b)("inlineCode",{parentName:"p"},"maxCacheEntries()"),".\nYou can also specify a custom cache specification using ",Object(n.b)("inlineCode",{parentName:"p"},"entryCacheSpec()"),",\nas defined in ",Object(n.b)("a",{parentName:"p",href:"https://static.javadoc.io/com.github.ben-manes.caffeine/caffeine/2.8.0/com/github/benmanes/caffeine/cache/CaffeineSpec.html"},"Caffeine documentation"),".\nOr, you can override the default cache specification of ",Object(n.b)("inlineCode",{parentName:"p"},"maximumSize=1024")," using\nthe JVM property ",Object(n.b)("inlineCode",{parentName:"p"},"-Dcom.linecorp.armeria.fileServiceCache=<spec>"),"."),Object(n.b)("h2",{id:"serving-pre-compressed-files",style:{position:"relative"}},Object(n.b)("a",{parentName:"h2",href:"#serving-pre-compressed-files","aria-label":"serving pre compressed files permalink",className:"anchor before"},Object(n.b)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},Object(n.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"Serving pre-compressed files"),Object(n.b)("p",null,Object(n.b)("a",{parentName:"p",href:"type://FileService:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/FileService.html"},"type://FileService")," can be configured to serve a pre-compressed file based on the value of the\n",Object(n.b)("inlineCode",{parentName:"p"},"Accept-Encoding")," header. For example, if a client sent the following HTTP request:"),Object(n.b)("pre",null,Object(n.b)("code",{parentName:"pre",className:"language-http"},"GET /index.html HTTP/1.1\nHost: example.com\nAccept-Encoding: gzip, identity\n")),Object(n.b)("p",null,Object(n.b)("a",{parentName:"p",href:"type://FileService:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/FileService.html"},"type://FileService")," could look for ",Object(n.b)("inlineCode",{parentName:"p"},"/index.html.gz")," first and send the following response with the\n",Object(n.b)("inlineCode",{parentName:"p"},"Content-Encoding: gzip")," header if it exists:"),Object(n.b)("pre",null,Object(n.b)("code",{parentName:"pre",className:"language-http"},"HTTP/1.1 200 OK\nHost: example.com\nContent-Encoding: gzip\nContent-Type: text/html\n...\n\n<compressed content>\n")),Object(n.b)("p",null,"If ",Object(n.b)("inlineCode",{parentName:"p"},"/index.html.gz")," does not exist but ",Object(n.b)("inlineCode",{parentName:"p"},"/index.html")," does, it would fall back on serving the uncompressed\ncontent:"),Object(n.b)("pre",null,Object(n.b)("code",{parentName:"pre",className:"language-http"},"HTTP/1.1 200 OK\nHost: example.com\nContent-Type: text/html\n...\n\n<uncompressed content>\n")),Object(n.b)("p",null,"This behavior is enabled by calling ",Object(n.b)("a",{parentName:"p",href:"type://FileServiceBuilder#serveCompressedFiles(boolean):https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/FileServiceBuilder.html#serveCompressedFiles(boolean)"},"type://FileServiceBuilder#serveCompressedFiles(boolean)")," with ",Object(n.b)("inlineCode",{parentName:"p"},"true"),".\n",Object(n.b)("inlineCode",{parentName:"p"},".gz")," (gzip) and ",Object(n.b)("inlineCode",{parentName:"p"},".br")," (Brotli) files are supported currently."),Object(n.b)("pre",null,Object(n.b)("code",{parentName:"pre",className:"language-java"},'FileServiceBuilder fsb =\n        FileService.builder(ClassLoader.getSystemClassLoader(),\n                            "/com/example/resources");\n\n// Enable serving pre-compressed files.\nfsb.serveCompressedFiles(true);\n\nFileService fs = fsb.build();\n')),Object(n.b)("h2",{id:"serving-an-individual-file",style:{position:"relative"}},Object(n.b)("a",{parentName:"h2",href:"#serving-an-individual-file","aria-label":"serving an individual file permalink",className:"anchor before"},Object(n.b)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},Object(n.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"Serving an individual file"),Object(n.b)("p",null,"You can also serve an individual file using ",Object(n.b)("a",{parentName:"p",href:"type://HttpFile:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/HttpFile.html"},"type://HttpFile"),". Like ",Object(n.b)("a",{parentName:"p",href:"type://FileService:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/FileService.html"},"type://FileService")," does, ",Object(n.b)("a",{parentName:"p",href:"type://HttpFile:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/HttpFile.html"},"type://HttpFile"),"\nsupports ",Object(n.b)("inlineCode",{parentName:"p"},"GET")," and ",Object(n.b)("inlineCode",{parentName:"p"},"HEAD")," HTTP methods and will auto-fill ",Object(n.b)("inlineCode",{parentName:"p"},"Date"),", ",Object(n.b)("inlineCode",{parentName:"p"},"Last-Modified"),", ",Object(n.b)("inlineCode",{parentName:"p"},"ETag")," and\nauto-detected ",Object(n.b)("inlineCode",{parentName:"p"},"Content-Type")," headers for you. It is also capable of sending a ",Object(n.b)("inlineCode",{parentName:"p"},"304 Not Modified")," response\nbased on ",Object(n.b)("inlineCode",{parentName:"p"},"If-None-Match")," and ",Object(n.b)("inlineCode",{parentName:"p"},"If-Modified-Since")," header values."),Object(n.b)("pre",null,Object(n.b)("code",{parentName:"pre",className:"language-java"},'import com.linecorp.armeria.server.file.HttpFile;\n\nHttpFile favicon = HttpFile.of(Paths.get("/var/lib/www/favicon.ico"));\nServerBuilder sb = Server.builder();\n\n// Serve the favicon.ico file by converting an HttpFile into a service.\nsb.service("/favicon.ico", favicon.asService());\n')),Object(n.b)("p",null,"For instance, it is possible to serve the same file (e.g. ",Object(n.b)("inlineCode",{parentName:"p"},"index.html"),") for all requests under a certain\npath, which is useful when serving a frontend application with client-side routing."),Object(n.b)("pre",null,Object(n.b)("code",{parentName:"pre",className:"language-java"},'HttpFile index = HttpFile.of(Paths.get("/var/lib/www/index.html"));\n\nServerBuilder sb = Server.builder();\n// Register the file service for assets.\nsb.serviceUnder("/node_modules",\n                FileService.of(Paths.get("/var/lib/www/node_modules")));\nsb.serviceUnder("/static",\n                FileService.of(Paths.get("/var/lib/www/static")));\n// Register the fallback file service.\nsb.serviceUnder("/", index.asService());\n')),Object(n.b)("p",null,"You can also achieve the same behavior using ",Object(n.b)("a",{parentName:"p",href:"/docs/server-annotated-service"},"Annotated services"),":"),Object(n.b)("pre",null,Object(n.b)("code",{parentName:"pre",className:"language-java"},'// Register the fallback file service.\nsb.annotatedService(new Object() {\n    final HttpFile index = HttpFile.of(Paths.get("/var/lib/www/index.html"));\n    @Get\n    @Head\n    @Path("glob:/**")\n    public HttpResponse getIndex(ServiceRequestContext ctx, HttpRequest req) {\n        return index.asService().serve(ctx, req);\n    }\n});\n')),Object(n.b)("h2",{id:"configuring-httpfile",style:{position:"relative"}},Object(n.b)("a",{parentName:"h2",href:"#configuring-httpfile","aria-label":"configuring httpfile permalink",className:"anchor before"},Object(n.b)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},Object(n.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"Configuring ",Object(n.b)("inlineCode",{parentName:"h2"},"HttpFile")),Object(n.b)("p",null,"An ",Object(n.b)("a",{parentName:"p",href:"type://HttpFile:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/HttpFile.html"},"type://HttpFile")," can be configured to send different headers than the auto-filled ones using\n",Object(n.b)("a",{parentName:"p",href:"type://HttpFileBuilder:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/HttpFileBuilder.html"},"type://HttpFileBuilder"),". For example, you can:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"Disable auto-generation of ",Object(n.b)("inlineCode",{parentName:"li"},"Date"),", ",Object(n.b)("inlineCode",{parentName:"li"},"Last-Modified"),", ",Object(n.b)("inlineCode",{parentName:"li"},"Content-Type")," and ",Object(n.b)("inlineCode",{parentName:"li"},"ETag")," header."),Object(n.b)("li",{parentName:"ul"},"Customize how ",Object(n.b)("inlineCode",{parentName:"li"},"ETag")," is calculated from metadata."),Object(n.b)("li",{parentName:"ul"},"Add or set additional custom HTTP headers.")),Object(n.b)("pre",null,Object(n.b)("code",{parentName:"pre",className:"language-java"},"import com.linecorp.armeria.server.file.HttpFile;\nimport com.linecorp.armeria.server.file.HttpFileBuilder;\n\nHttpFileBuilder fb = HttpFile.builder(Paths.get(\"/var/lib/www/index.html\"));\n// Disable the 'Date' header.\nfb.date(false);\n// Disable the 'Last-Modified' header.\nfb.lastModified(false);\n// Disable the 'ETag' header.\nfb.entityTag(false);\n// Disable the 'Content-Type' header.\nfb.autoDetectContentType(false);\n// Set the 'Content-Type' header manually.\nfb.contentType(\"text/html; charset=EUC-KR\");\n// Set the 'Cache-Control' header.\nfb.cacheControl(ServerCacheControl.REVALIDATED /* \"no-cache\" */);\n// Set a custom header.\nfb.setHeader(\"x-powered-by\", \"Armeria\");\nHttpFile f = fb.build();\n")),Object(n.b)("h2",{id:"caching-httpfile",style:{position:"relative"}},Object(n.b)("a",{parentName:"h2",href:"#caching-httpfile","aria-label":"caching httpfile permalink",className:"anchor before"},Object(n.b)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},Object(n.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"Caching ",Object(n.b)("inlineCode",{parentName:"h2"},"HttpFile")),Object(n.b)("p",null,"Unlike ",Object(n.b)("a",{parentName:"p",href:"type://FileService:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/FileService.html"},"type://FileService"),", ",Object(n.b)("a",{parentName:"p",href:"type://HttpFile:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/HttpFile.html"},"type://HttpFile")," does not cache the file content.\nUse ",Object(n.b)("a",{parentName:"p",href:"type://HttpFile#ofCached(HttpFile,int):https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/HttpFile.html#ofCached(com.linecorp.armeria.server.file.HttpFile,int)"},"type://HttpFile#ofCached(HttpFile,int)")," to enable content caching for an existing ",Object(n.b)("a",{parentName:"p",href:"type://HttpFile:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/HttpFile.html"},"type://HttpFile"),":"),Object(n.b)("pre",null,Object(n.b)("code",{parentName:"pre",className:"language-java"},'HttpFile uncachedFile = HttpFile.of(Paths.get("/var/lib/www/index.html"));\nHttpFile cachedFile = HttpFile.ofCached(uncachedFile, 65536);\n')),Object(n.b)("p",null,"Note that you need to specify the maximum allowed length of the cached content. In the above example, the file\nwill not be cached if the length of the file exceeds 65,536 bytes."),Object(n.b)("h2",{id:"aggregating-httpfile",style:{position:"relative"}},Object(n.b)("a",{parentName:"h2",href:"#aggregating-httpfile","aria-label":"aggregating httpfile permalink",className:"anchor before"},Object(n.b)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},Object(n.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"Aggregating ",Object(n.b)("inlineCode",{parentName:"h2"},"HttpFile")),Object(n.b)("p",null,"An ",Object(n.b)("a",{parentName:"p",href:"type://HttpFile:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/HttpFile.html"},"type://HttpFile")," usually does not store its content in memory but reads its content on demand, allowing you\nto stream a potentially very large file. If you want to ensure the content of the file is kept in memory so\nthat file I/O does not occur on each retrieval, you can use the ",Object(n.b)("a",{parentName:"p",href:"type://HttpFile#aggregate(Executor):https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/HttpFile.html#aggregate(java.util.concurrent.Executor)"},"type://HttpFile#aggregate(Executor)")," method:"),Object(n.b)("pre",null,Object(n.b)("code",{parentName:"pre",className:"language-java"},'// You need to prepare an Executor which will be used for reading the file,\n// because file I/O is often a blocking operation.\nExecutor ioExecutor = ...;\n\nHttpFile file = HttpFile.of(Paths.get("/var/lib/www/img/logo.png");\nCompletableFuture<AggregatedHttpFile> future = file.aggregate(ioExecutor);\nAggregatedHttpFile aggregated = future.join();\n\n// The content of the file can now be retrieved from memory.\nHttpData content = aggregated.content();\n')),Object(n.b)("p",null,"Note that an aggregated ",Object(n.b)("a",{parentName:"p",href:"type://HttpFile:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/HttpFile.html"},"type://HttpFile")," is not linked in any way from the ",Object(n.b)("a",{parentName:"p",href:"type://HttpFile:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/HttpFile.html"},"type://HttpFile")," it was aggregated\nfrom, which means the content and attributes of the aggregated ",Object(n.b)("a",{parentName:"p",href:"type://HttpFile:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/HttpFile.html"},"type://HttpFile")," does not change when the original\n",Object(n.b)("a",{parentName:"p",href:"type://HttpFile:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/HttpFile.html"},"type://HttpFile")," changes. Use ",Object(n.b)("a",{parentName:"p",href:"type://HttpFile#ofCached(HttpFile,int):https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/HttpFile.html#ofCached(com.linecorp.armeria.server.file.HttpFile,int)"},"type://HttpFile#ofCached(HttpFile,int)")," instead if such behavior is necessary."),Object(n.b)("h2",{id:"building-aggregatedhttpfile-from-httpdata",style:{position:"relative"}},Object(n.b)("a",{parentName:"h2",href:"#building-aggregatedhttpfile-from-httpdata","aria-label":"building aggregatedhttpfile from httpdata permalink",className:"anchor before"},Object(n.b)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},Object(n.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"Building ",Object(n.b)("inlineCode",{parentName:"h2"},"AggregatedHttpFile")," from ",Object(n.b)("inlineCode",{parentName:"h2"},"HttpData")),Object(n.b)("p",null,"The content you need to serve is not always from an external resource but sometimes from memory, such as\n",Object(n.b)("inlineCode",{parentName:"p"},"byte[]")," or ",Object(n.b)("inlineCode",{parentName:"p"},"String"),". Use ",Object(n.b)("a",{parentName:"p",href:"type://HttpFile#of(HttpData):https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/HttpFile.html#of(com.linecorp.armeria.common.HttpData)"},"type://HttpFile#of(HttpData)")," or ",Object(n.b)("a",{parentName:"p",href:"type://HttpFile#builder(HttpData):https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/HttpFile.html#builder(com.linecorp.armeria.common.HttpData)"},"type://HttpFile#builder(HttpData)")," to build an\n",Object(n.b)("a",{parentName:"p",href:"type://AggregatedHttpFile:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/AggregatedHttpFile.html"},"type://AggregatedHttpFile")," from an in-memory resource:"),Object(n.b)("pre",null,Object(n.b)("code",{parentName:"pre",className:"language-java"},'// Build from a byte array.\nAggregatedHttpFile f1 = AggregatedHttpFile.of(HttpData.of(new byte[] { 1, 2, 3, 4 }));\n\n// Build from a String.\nAggregatedHttpFile f2 = AggregatedHttpFile.of(HttpData.ofUtf8("Hello, world!"));\n\n// Build using a builder.\nAggregatedHttpFile f3 =\n    AggregatedHttpFile.builder(HttpData.ofAscii("Armeria"))\n                      .lastModified(false)\n                      .build();\n')))}b.isMDXComponent=!0},xCMr:function(e,a,t){"use strict";var i=t("Wbzz"),r=t("q1tI"),n=t.n(r),c=t("/94A"),l=t("+ejy");a.a=function(e){var a=Object(i.useStaticQuery)("1217743243").allMdx.nodes;return n.a.createElement(l.a,Object.assign({},e,{candidateMdxNodes:a,index:c,prefix:"docs",pageTitleSuffix:"Armeria documentation"}))}}}]);
//# sourceMappingURL=component---src-pages-docs-server-http-file-mdx-69655dab26b735aecbfe.js.map